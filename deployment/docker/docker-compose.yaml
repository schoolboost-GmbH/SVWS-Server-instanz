version: "3.9"

volumes:
  svws_keystore:
  svws_logs:
  mariadb_data:

services:
  mariadb:
    image: mariadb:11.7
    command: >
      --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci
    environment:
      MARIADB_ROOT_PASSWORD: ${MARIADB_ROOT_PASSWORD}
      MARIADB_DATABASE: ${MARIADB_DATABASE}
      MARIADB_USER: ${MARIADB_USER}
      MARIADB_PASSWORD: ${MARIADB_PASSWORD}
    volumes:
      - mariadb_data:/var/lib/mysql
    # Uncomment ports if external access is needed
    # ports:
    #   - "3306:3306"

  svws:
    build:
      dockerfile: deployment/docker/svws/Dockerfile
    depends_on:
      - mariadb
    ports:
      - "8465:8443"
    environment:
      MARIADB_HOST: mariadb
      MARIADB_DATABASE: ${MARIADB_DATABASE}
      MARIADB_USER: ${MARIADB_USER}
      MARIADB_PASSWORD: ${MARIADB_PASSWORD}
      SVWS_TLS_KEYSTORE_PATH: /etc/app/svws/conf/keystore
      SVWS_TLS_KEYSTORE_PASSWORD: ${SVWS_TLS_KEYSTORE_PASSWORD}
      SVWS_TLS_KEY_ALIAS: ${SVWS_TLS_KEY_ALIAS}
      # IMPORTANT: Disable test data import after first initialization
      IMPORT_TEST_DATA: "false"
    volumes:
      - svws_keystore:/etc/app/svws/conf/keystore
      - svws_logs:/opt/app/svws/logs
    networks:
      - coolify
    labels:
      - coolify.managed=true
      - coolify.proxy=true
      - traefik.http.services.svws.loadbalancer.server.port=8443
